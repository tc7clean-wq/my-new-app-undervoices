import{c as O,a as z,d as D,u as H,j as e,L as U}from"./index-Dc-RHZ8Q.js";import{i as I,e as R,d as s}from"./vendor-DZhegkiK.js";import{u as V}from"./useVoiceHints-BWE_yW86.js";import"./api-ngrFHoWO.js";import"./crypto-DhyMKz0y.js";const X=()=>{const{id:n}=I(),o=R(),i=!!n,[r,y]=s.useState({title:"",summary:"",content:"",tags:[],isPublic:!1,allowComments:!0,verification_status:"draft"}),[g,x]=s.useState(!1),[S,b]=s.useState(i),[m,C]=s.useState(!1),[u,E]=s.useState(!0),[f,L]=s.useState(null),[A,P]=s.useState(0),[T,W]=s.useState(0),{user:Y}=O(),{showNotification:d,userPreferences:h}=z(),{saveOffline:j,isOnline:p}=D(),{get:F,post:k,put:v}=H(),{announceHints:w}=V();s.useEffect(()=>{i&&$()},[n,i]),s.useEffect(()=>{h.enableVoiceHints&&h.showTutorials&&setTimeout(()=>{w("article-editor")},2e3)},[w,h]),s.useEffect(()=>{if(!u||!r.title)return;const t=setTimeout(()=>{p?N(!0):j("article",r,{action:i?"update":"create"})},2e3);return()=>clearTimeout(t)},[r,u,p]),s.useEffect(()=>{const t=r.content.trim().split(/\s+/).filter(a=>a.length>0).length;P(t),W(Math.ceil(t/200))},[r.content]);const $=async()=>{try{b(!0);const t=await F(`/articles/${n}`);if(t.success)y(t.article);else throw new Error(t.message||"Failed to load article")}catch(t){d({type:"error",title:"Load Failed",message:t.message||"Failed to load article"}),o("/dashboard")}finally{b(!1)}},N=async(t=!1)=>{try{x(!0);const a={...r,id:i?n:void 0};let l;if(i?l=await v(`/articles/${n}`,a):l=await k("/articles",a),l.success)L(new Date),t||d({type:"success",title:"Saved",message:"Article saved successfully"}),!i&&l.article?.id&&o(`/article/${l.article.id}/edit`,{replace:!0});else throw new Error(l.message||"Failed to save")}catch(a){p?d({type:"error",title:"Save Failed",message:a.message||"Failed to save article"}):(j("article",r,{action:i?"update":"create"}),d({type:"info",title:"Saved Offline",message:"Changes saved locally and will sync when online"}))}finally{x(!1)}},M=async()=>{try{x(!0);const t={...r,verification_status:"published",published_at:new Date().toISOString()};let a;if(i?a=await v(`/articles/${n}`,t):a=await k("/articles",t),a.success)d({type:"success",title:"Published!",message:"Your article is now live and visible to readers"}),o(`/article/${a.article.id}`);else throw new Error(a.message||"Failed to publish")}catch(t){d({type:"error",title:"Publish Failed",message:t.message||"Failed to publish article"})}finally{x(!1)}},c=(t,a)=>{y(l=>({...l,[t]:a}))},_=t=>{const a=t.split(",").map(l=>l.trim()).filter(Boolean);c("tags",a)},B=t=>t.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/\n\n/g,"</p><p>").replace(/\n/g,"<br>").replace(/^/,"<p>").replace(/$/,"</p>");return S?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(U,{size:"large",text:"Loading article..."})}):e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-16",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:()=>o("/dashboard"),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200","aria-label":"Back to dashboard",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:i?"Edit Article":"Write New Article"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Share your story with the world"})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:u,onChange:t=>E(t.target.checked),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Auto-save"})]}),f&&e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Saved ",f.toLocaleTimeString()]}),e.jsxs("button",{onClick:()=>C(!m),className:"bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-white px-4 py-2 rounded-lg font-medium transition-colors duration-200 flex items-center space-x-2",children:[e.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),e.jsx("span",{children:m?"Edit":"Preview"})]}),e.jsxs("button",{onClick:()=>N(),disabled:g,className:"bg-primary-600 hover:bg-primary-700 disabled:bg-primary-400 text-white px-4 py-2 rounded-lg font-medium transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 flex items-center space-x-2",children:[g&&e.jsx("div",{className:"spinner"}),e.jsx("span",{children:g?"Saving...":"Save"})]}),e.jsxs("button",{onClick:M,disabled:g||!r.title||!r.content,className:"bg-green-600 hover:bg-green-700 disabled:bg-green-400 text-white px-4 py-2 rounded-lg font-medium transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 flex items-center space-x-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})}),e.jsx("span",{children:"Publish"})]})]})]})})}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 border border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Article Stats"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Words:"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:A})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Reading time:"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:[T," min"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Status:"}),e.jsx("span",{className:`text-sm font-medium px-2 py-1 rounded-full ${r.verification_status==="published"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200"}`,children:r.verification_status})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 border border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Settings"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{children:e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:r.isPublic,onChange:t=>c("isPublic",t.target.checked),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"Make public"})]})}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:r.allowComments,onChange:t=>c("allowComments",t.target.checked),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"Allow comments"})]})})]})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-6 border border-blue-200 dark:border-blue-800",children:[e.jsx("h3",{className:"text-lg font-medium text-blue-900 dark:text-blue-100 mb-4",children:"Writing Tips"}),e.jsxs("ul",{className:"text-sm text-blue-700 dark:text-blue-300 space-y-2",children:[e.jsx("li",{children:"• Use a compelling headline"}),e.jsx("li",{children:"• Write a clear summary"}),e.jsx("li",{children:"• Add relevant tags"}),e.jsx("li",{children:"• Use **bold** and *italic* for emphasis"}),e.jsx("li",{children:"• Break up long paragraphs"}),e.jsx("li",{children:"• Include sources and evidence"})]})]})]}),e.jsx("div",{className:"lg:col-span-3",children:m?e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-8 border border-gray-200 dark:border-gray-700",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-4",children:r.title||"Untitled Article"}),r.summary&&e.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-400 mb-6 italic",children:r.summary}),e.jsx("div",{className:"prose dark:prose-invert max-w-none",dangerouslySetInnerHTML:{__html:B(r.content)}}),r.tags.length>0&&e.jsx("div",{className:"mt-8 pt-6 border-t border-gray-200 dark:border-gray-700",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:r.tags.map((t,a)=>e.jsxs("span",{className:"px-3 py-1 bg-primary-100 dark:bg-primary-900 text-primary-800 dark:text-primary-200 rounded-full text-sm",children:["#",t]},a))})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Title *"}),e.jsx("input",{type:"text",value:r.title,onChange:t=>c("title",t.target.value),placeholder:"Enter a compelling headline...",className:"w-full px-4 py-3 text-2xl font-bold border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Summary"}),e.jsx("textarea",{value:r.summary,onChange:t=>c("summary",t.target.value),placeholder:"Write a brief summary of your article...",rows:3,className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Content *"}),e.jsx("textarea",{value:r.content,onChange:t=>c("content",t.target.value),placeholder:"Write your article here... Use **bold** and *italic* for formatting.",rows:20,className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white font-mono"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Tags"}),e.jsx("input",{type:"text",value:r.tags.join(", "),onChange:t=>_(t.target.value),placeholder:"Enter tags separated by commas...",className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]})]})})]})})]})};export{X as default};

import{c as U,a as G,d as H,u as J,j as e,L as Q}from"./index-Dc-RHZ8Q.js";import{i as V,e as X,d as o}from"./vendor-DZhegkiK.js";import{S as Y}from"./StoryboardCanvas-DkCa5LDl.js";import"./api-ngrFHoWO.js";import"./crypto-DhyMKz0y.js";const de=()=>{const{id:i}=V(),m=X(),l=!!i,[r,d]=o.useState({title:"",description:"",nodes:[],edges:[],isPublic:!1,isCollaborative:!0,tags:[]}),[y,n]=o.useState(!1),[c,j]=o.useState(l),[D,b]=o.useState(!1),[x,p]=o.useState(null),[f,A]=o.useState(!0),[N,F]=o.useState(null),{user:_}=U(),{showNotification:h}=G(),{saveOffline:w,isOnline:k}=H(),{get:T,post:$,put:M}=J();o.useEffect(()=>{l&&O()},[i,l]),o.useEffect(()=>{if(!f||!r.title)return;const a=setTimeout(()=>{k?S(!0):w("storyboard",r,{action:l?"update":"create"})},2e3);return()=>clearTimeout(a)},[r,f,k]);const O=async()=>{try{j(!0);const a=await T(`/storyboards/${i}`);if(a.success)d(a.storyboard);else throw new Error(a.message||"Failed to load storyboard")}catch(a){h({type:"error",title:"Load Failed",message:a.message||"Failed to load storyboard"}),m("/dashboard")}finally{j(!1)}},S=async(a=!1)=>{try{n(!0);const t={...r,id:l?i:void 0};let s;if(l?s=await M(`/storyboards/${i}`,t):s=await $("/storyboards",t),s.success)F(new Date),a||h({type:"success",title:"Saved",message:"Storyboard saved successfully"}),!l&&s.storyboard?.id&&m(`/storyboard/${s.storyboard.id}/edit`,{replace:!0});else throw new Error(s.message||"Failed to save")}catch(t){k?h({type:"error",title:"Save Failed",message:t.message||"Failed to save storyboard"}):(w("storyboard",r,{action:l?"update":"create"}),h({type:"info",title:"Saved Offline",message:"Changes saved locally and will sync when online"}))}finally{n(!1)}},P=o.useCallback(a=>{d(t=>({...t,nodes:a}))},[]),B=o.useCallback(a=>{d(t=>({...t,edges:a}))},[]),I=o.useCallback(a=>{p(a)},[]),z=o.useCallback(a=>{p(a),b(!0)},[]),K=a=>{const t=r.nodes.map(s=>s.data.id===a.id?{...s,data:a}:s);d(s=>({...s,nodes:t})),b(!1)},R=a=>{const s={data:{id:`node-${Date.now()}`,label:"New Connection",type:"default",description:"",url:"",tags:[]},position:{x:200,y:200}};d(g=>({...g,nodes:[...g.nodes,s]})),p(s.data),b(!0)},W=o.useCallback(()=>{const a=[];return r.nodes.forEach((t,s)=>{r.nodes.forEach((g,q)=>{if(s>=q||r.edges.find(u=>u.data.source===t.data.id&&u.data.target===g.data.id||u.data.source===g.data.id&&u.data.target===t.data.id))return;const E=C(t.data.label+" "+t.data.description),L=C(g.data.label+" "+g.data.description),v=E.filter(u=>L.includes(u));v.length>0&&a.push({source:t.data.id,target:g.data.id,reason:`Common themes: ${v.join(", ")}`,confidence:v.length/Math.max(E.length,L.length)})})}),a.sort((t,s)=>s.confidence-t.confidence).slice(0,5)},[r.nodes,r.edges]),C=a=>{if(!a)return[];const t=["the","a","an","and","or","but","in","on","at","to","for","of","with","by","is","are","was","were","be","been","being"];return a.toLowerCase().replace(/[^\w\s]/g,"").split(/\s+/).filter(s=>s.length>3&&!t.includes(s))};return c?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(Q,{size:"large",text:"Loading storyboard..."})}):e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-16",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:()=>m("/dashboard"),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200","aria-label":"Back to dashboard",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:l?"Edit Storyboard":"New Storyboard"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Connect the dots between events, people, and places"})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:f,onChange:a=>A(a.target.checked),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Auto-save"})]}),N&&e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Saved ",N.toLocaleTimeString()]}),e.jsxs("button",{onClick:()=>S(),disabled:y,className:"bg-primary-600 hover:bg-primary-700 disabled:bg-primary-400 text-white px-4 py-2 rounded-lg font-medium transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 flex items-center space-x-2",children:[y&&e.jsx("div",{className:"spinner"}),e.jsx("span",{children:y?"Saving...":"Save"})]})]})]})})}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 border border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Details"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Title"}),e.jsx("input",{type:"text",value:r.title,onChange:a=>d(t=>({...t,title:a.target.value})),placeholder:"Enter storyboard title",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-primary-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Description"}),e.jsx("textarea",{value:r.description,onChange:a=>d(t=>({...t,description:a.target.value})),placeholder:"Describe what this storyboard explores",rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-primary-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:r.isPublic,onChange:a=>d(t=>({...t,isPublic:a.target.checked})),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"Make public"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:r.isCollaborative,onChange:a=>d(t=>({...t,isCollaborative:a.target.checked})),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"Allow collaboration"})]})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 border border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Tools"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>R(),className:"w-full bg-primary-100 hover:bg-primary-200 dark:bg-primary-900 dark:hover:bg-primary-800 text-primary-700 dark:text-primary-300 px-4 py-2 rounded-lg font-medium transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary-500",children:"Add Node"}),e.jsx("button",{onClick:()=>{const a=W();console.log("Connection suggestions:",a),h({type:"info",title:"AI Suggestions",message:`Found ${a.length} potential connections`})},className:"w-full bg-green-100 hover:bg-green-200 dark:bg-green-900 dark:hover:bg-green-800 text-green-700 dark:text-green-300 px-4 py-2 rounded-lg font-medium transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-green-500",children:"Suggest Connections"})]})]}),x&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 border border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Selected Node"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Label:"}),e.jsx("p",{className:"text-sm text-gray-900 dark:text-white",children:x.label})]}),x.description&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Description:"}),e.jsx("p",{className:"text-sm text-gray-900 dark:text-white",children:x.description})]}),e.jsx("button",{onClick:()=>b(!0),className:"w-full bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 px-4 py-2 rounded-lg font-medium transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"Edit Node"})]})]})]}),e.jsx("div",{className:"lg:col-span-3",children:e.jsx(Y,{nodes:r.nodes,edges:r.edges,onNodesChange:P,onEdgesChange:B,onNodeSelect:I,onNodeDoubleClick:z,height:"calc(100vh - 200px)",className:"rounded-lg shadow-sm"})})]})}),D&&x&&e.jsx(Z,{nodeData:x,onSave:K,onClose:()=>b(!1)})]})},Z=({nodeData:i,onSave:m,onClose:l})=>{const[r,d]=o.useState({id:i.id,label:i.label||"",description:i.description||"",url:i.url||"",tags:i.tags?.join(", ")||"",type:i.type||"default"}),y=n=>{n.preventDefault(),m({...r,tags:r.tags.split(",").map(c=>c.trim()).filter(Boolean)})};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg max-w-md w-full p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Edit Node"}),e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Label"}),e.jsx("input",{type:"text",value:r.label,onChange:n=>d(c=>({...c,label:n.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-primary-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Description"}),e.jsx("textarea",{value:r.description,onChange:n=>d(c=>({...c,description:n.target.value})),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-primary-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Source URL"}),e.jsx("input",{type:"url",value:r.url,onChange:n=>d(c=>({...c,url:n.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-primary-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Tags (comma-separated)"}),e.jsx("input",{type:"text",value:r.tags,onChange:n=>d(c=>({...c,tags:n.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-primary-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:l,className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-md transition-colors duration-200",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 rounded-md transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2",children:"Save"})]})]})]})})};export{de as default};

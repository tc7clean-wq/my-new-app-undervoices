import{a as I,d as q,b as J,j as n}from"./index-Dc-RHZ8Q.js";import{d as a}from"./vendor-DZhegkiK.js";const X=({nodes:o=[],edges:c=[],onNodesChange:m,onEdgesChange:f,readonly:s=!1,onNodeSelect:z,onNodeDoubleClick:T,onEdgeSelect:M,onBackgroundClick:S,className:L="",height:Z="600px"})=>{const p=a.useRef(null),e=a.useRef(null),[d,b]=a.useState(null),[h,x]=a.useState(null),[K,C]=a.useState(!1),[v,g]=a.useState(!1),[k,j]=a.useState({x:0,y:0}),[P,A]=a.useState(1),{isDark:E,showNotification:F}=I(),{isOnline:R}=q();a.useEffect(()=>{if(!(!p.current||e.current)){if(typeof cytoscape>"u"){console.error("Cytoscape.js not loaded");return}try{e.current=cytoscape({container:p.current,elements:[...o,...c],style:B(E),layout:{name:"cose",animate:!0,animationDuration:1e3,animationEasing:"ease-out",nodeRepulsion:8e3,nodeOverlap:20,idealEdgeLength:100,edgeElasticity:100,nestingFactor:5,gravity:80,numIter:1e3,initialTemp:200,coolingFactor:.95,minTemp:1},zoom:1,pan:{x:0,y:0},minZoom:.1,maxZoom:3,zoomingEnabled:!0,userZoomingEnabled:!s,panningEnabled:!0,userPanningEnabled:!0,boxSelectionEnabled:!s,selectionType:"single",touchTapThreshold:8,desktopTapThreshold:4,autolock:s,autoungrabify:s}),O(),o.length>0&&setTimeout(()=>{e.current?.fit(null,50)},100)}catch(t){console.error("Error initializing Cytoscape:",t),F({type:"error",title:"Canvas Error",message:"Failed to initialize storyboard canvas"})}return()=>{e.current&&(e.current.destroy(),e.current=null)}}},[]),a.useEffect(()=>{if(e.current)try{e.current.elements().remove(),e.current.add([...o,...c]),o.length>0&&e.current.layout({name:"cose",animate:!1}).run()}catch(t){console.error("Error updating canvas elements:",t)}},[o,c]),a.useEffect(()=>{e.current&&e.current.style(B(E))},[E]);const O=()=>{e.current&&(e.current.on("tap","node",t=>{const r=t.target;b(r.id()),x(null),z?.(r.data()),e.current.nodes().removeClass("selected"),r.addClass("selected")}),e.current.on("doubleTap","node",t=>{const r=t.target;T?.(r.data(),t.position||t.cyPosition)}),e.current.on("tap","edge",t=>{const r=t.target;x(r.id()),b(null),M?.(r.data()),e.current.edges().removeClass("selected"),r.addClass("selected")}),e.current.on("tap",t=>{t.target===e.current&&(b(null),x(null),e.current.elements().removeClass("selected"),S?.(t.position||t.cyPosition))}),e.current.on("cxttap",t=>{if(s)return;t.preventDefault();const r=t.position||t.cyPosition;j({x:r.x+p.current.offsetLeft,y:r.y+p.current.offsetTop}),g(!0)}),e.current.on("dragstart","node",()=>{C(!0)}),e.current.on("dragfree","node",t=>{if(C(!1),!s){const r=t.target,l=r.position(),y=o.map(i=>i.data.id===r.id()?{...i,position:l}:i);m?.(y)}}),e.current.on("zoom",()=>{A(e.current.zoom())}),e.current.on("viewport",()=>{v&&g(!1)}))},{bindGestures:D}=J({onPinchStart:()=>{e.current&&e.current.userZoomingEnabled(!0)},onPinchMove:t=>{if(e.current&&!s){const r=e.current.zoom(),l=Math.max(.1,Math.min(3,r*t));e.current.zoom(l)}},onDoubleTap:t=>{e.current&&e.current.fit(null,50)},onLongPress:t=>{s||(j({x:t.x,y:t.y}),g(!0))}}),H=a.useCallback((t,r={})=>{if(s)return;const l=`node-${Date.now()}`,y={data:{id:l,label:r.label||"New Node",type:r.type||"default",...r},position:t||{x:100,y:100}},i=[...o,y];return m?.(i),setTimeout(()=>{if(e.current){const w=e.current.getElementById(l);w.addClass("newly-added"),setTimeout(()=>{w.removeClass("newly-added")},1e3)}},100),l},[o,m,s]);a.useCallback((t,r,l={})=>{if(s||!t||!r)return;if(c.find(u=>u.data.source===t&&u.data.target===r||u.data.source===r&&u.data.target===t)){F({type:"warning",title:"Connection exists",message:"These nodes are already connected"});return}const i=`edge-${Date.now()}`,w={data:{id:i,source:t,target:r,label:l.label||"",type:l.type||"default",...l}},G=[...c,w];return f?.(G),setTimeout(()=>{if(e.current){const u=e.current.getElementById(i);u.addClass("newly-added"),setTimeout(()=>{u.removeClass("newly-added")},1e3)}},100),i},[c,f,s,F]);const N=a.useCallback(()=>{if(!s){if(d){const t=o.filter(l=>l.data.id!==d),r=c.filter(l=>l.data.source!==d&&l.data.target!==d);m?.(t),f?.(r),b(null)}else if(h){const t=c.filter(r=>r.data.id!==h);f?.(t),x(null)}}},[d,h,o,c,m,f,s]),W=a.useCallback(()=>{e.current&&e.current.fit(null,50)},[]),V=a.useCallback(()=>{e.current&&e.current.zoom(e.current.zoom()*1.2)},[]),$=a.useCallback(()=>{e.current&&e.current.zoom(e.current.zoom()*.8)},[]);return n.jsxs("div",{className:`relative ${L}`,style:{height:Z},children:[n.jsx("div",{ref:p,className:"w-full h-full bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",...D(),role:"img","aria-label":"Interactive storyboard canvas"}),!s&&n.jsxs("div",{className:"absolute top-4 right-4 flex flex-col space-y-2",children:[n.jsx("button",{onClick:V,className:"p-2 bg-white dark:bg-gray-800 rounded-md shadow-sm border border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary-500","aria-label":"Zoom in",children:n.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})}),n.jsx("button",{onClick:$,className:"p-2 bg-white dark:bg-gray-800 rounded-md shadow-sm border border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary-500","aria-label":"Zoom out",children:n.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M18 12H6"})})}),n.jsx("button",{onClick:W,className:"p-2 bg-white dark:bg-gray-800 rounded-md shadow-sm border border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary-500","aria-label":"Center view",children:n.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})}),(d||h)&&n.jsx("button",{onClick:N,className:"p-2 bg-red-500 text-white rounded-md shadow-sm hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-500","aria-label":"Delete selected",children:n.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),n.jsxs("div",{className:"absolute bottom-4 left-4 text-xs text-gray-500 dark:text-gray-400 bg-white dark:bg-gray-800 px-2 py-1 rounded border border-gray-200 dark:border-gray-700",children:["Zoom: ",Math.round(P*100),"% | Nodes: ",o.length," | Edges: ",c.length,!R&&n.jsx("span",{className:"text-orange-500 ml-2",children:"Offline"})]}),v&&!s&&n.jsxs("div",{className:"absolute bg-white dark:bg-gray-800 rounded-md shadow-lg border border-gray-200 dark:border-gray-700 py-1 z-10",style:{left:k.x,top:k.y},children:[n.jsx("button",{onClick:()=>{H(k),g(!1)},className:"block w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",children:"Add Node"}),d&&n.jsx("button",{onClick:()=>{N(),g(!1)},className:"block w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-gray-100 dark:hover:bg-gray-700",children:"Delete Node"})]}),v&&n.jsx("div",{className:"fixed inset-0 z-0",onClick:()=>g(!1)})]})},B=o=>[{selector:"node",style:{"background-color":o?"#4F46E5":"#3B82F6",label:"data(label)",color:o?"#FFFFFF":"#1F2937","text-valign":"center","text-halign":"center","font-size":"12px","font-weight":"500",width:"60px",height:"60px","border-width":"2px","border-color":o?"#6366F1":"#2563EB","text-outline-width":"2px","text-outline-color":o?"#1F2937":"#FFFFFF","transition-property":"background-color, border-color, width, height","transition-duration":"0.3s"}},{selector:"node:selected, node.selected",style:{"border-color":"#F59E0B","border-width":"3px","background-color":o?"#F59E0B":"#FBBF24"}},{selector:"node:hover",style:{width:"70px",height:"70px","border-width":"3px"}},{selector:"node.newly-added",style:{"background-color":"#10B981","border-color":"#059669",width:"80px",height:"80px"}},{selector:"edge",style:{"curve-style":"bezier","target-arrow-shape":"triangle","arrow-scale":1.5,"line-color":o?"#6B7280":"#9CA3AF","target-arrow-color":o?"#6B7280":"#9CA3AF",width:"2px",label:"data(label)","font-size":"10px","text-rotation":"autorotate","text-margin-y":"-10px",color:o?"#D1D5DB":"#374151","transition-property":"line-color, target-arrow-color, width","transition-duration":"0.3s"}},{selector:"edge:selected, edge.selected",style:{"line-color":"#F59E0B","target-arrow-color":"#F59E0B",width:"3px"}},{selector:"edge:hover",style:{width:"4px","line-color":o?"#4F46E5":"#3B82F6","target-arrow-color":o?"#4F46E5":"#3B82F6"}},{selector:"edge.newly-added",style:{"line-color":"#10B981","target-arrow-color":"#10B981",width:"4px"}}];export{X as S};
